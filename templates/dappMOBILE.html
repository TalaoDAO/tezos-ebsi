<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
  <!--
  <link rel="stylesheet" type="text/css" href="/static/bootstrap.min.css'">
  <link rel="stylesheet" type="text/css" href="/static/Footer-Clean.css">
  <link rel="stylesheet" type="text/css" href="/static/fontawesome/css/all.css">
  <link rel="stylesheet" type="text/css" href="/static/typeahead.css">
  <link rel='stylesheet' href="/static/fontawesome/css/fontawesome.min.css">-->
  <script> window.beaconSdkDebugEnabled = true    </script>
  <script src="/static/walletbeacon.min.js"></script>
  <link rel="stylesheet" href="/static/styleMobile.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/static/icon.png" sizes="16x16">
  <title>Altme Identity - Add an identity to your favorite wallet !</title>

</head>

<body>
  <div id="page">
    <div id="large">
      <div id="menuDiv" class="nav-02__list_wrapper  ">
        <div class="nav-02__list nav-02__list--desktop">
          <div class="nav-02__item">
            <a class="button   button--black-outline  button--empty " href="https://altme.io/"
              target="_self">
              <p class="linkP"> Back to home
              </p>
            </a>
          </div>
          <!--
          <div class="nav-02__item" id="newsNav">
            <a class="button   button--black-outline  button--empty " href="https://altme.io/#posts-05-876621"
              target="_self">
              <p class="linkP">News</p>

            </a>
          </div>
          <div class="nav-02__item" id="roadmapNav">
            <a href="https://altme.io/#features-09-390941" target="_self">
              <p class="linkP">Roadmap</p>

            </a>
          </div>
          <div class="nav-02__item" id="faqNav">
            <a class="button   button--black-outline  button--empty " href="#superFaq" target="_self">
              <p class="linkP">FAQ</p>
            </a>
          </div>-->
          <div class="nav-02__item">

            <a data-stripe-product-id="" data-stripe-mode="payment" data-successful-payment-url=""
              data-cancel-payment-url="" class="button button--accent-bg "
              href="mailto:contact@altme.io?cc=hugo@altme.io&subject=Altme" target="_blank">
              <div class="contactSpan">
                <p class="contactP">Contact</p>
              </div>
            </a>
          </div>
        </div>


      </div>
      <div class="js-nav nav-02  nav-02--sticky  nav-02--sticky--white  ">
        <div class="nav-02__box">
          <div class="nav-02__logo">
            <a class="nav-02__link" href="https://altme.io/" target="_self">
              <img loading="lazy" class="nav-02__logo_img"
                src="https://unicorn-cdn.b-cdn.net/653ef4c9-deb9-41af-9fa0-dc973cdd8134/altme-identity-wallet---blockchain---web3---self-sovereign-identity---decentralized-identity---ebsi---ssi---did---digital-identity---logo.png" height="70" alt="Logo" />
            </a>
          </div>


        </div>
        <button id="buttonMenu">
          <div id="buttonMenuLogo">
            <img id="imageButtonMenu" class="imgButtonMenuInactive" src="/static/div.png">
          </div>
        </button>

      </div>
      <div id="body">


        <div id="bigBox">
          <div id="titles">
            <div id="title">
              <p id="titleP">Add an identity to your favorite wallet
              </p>
            </div>
            <div id="textTop">
              <p id="textTopP">Start using secure and verifiable digital credentials with your favorite wallet by
                verifying your blockchain address and obtaining a “Proof of ownership” in Altme wallet !</p>
            </div>



          </div>
          <div id="mainBox">
            <div id="rightBox"> <img id="draw" src="/static/IllustrationTez.png">
            </div>
            <div id="leftBox">
              <div id="leftTop">
                <div id="step1Div">
                  <p id="step1">Step 1 : Choose your crypto wallet
                  </p>
                </div>
                <div id="chooseDiv">
                  <p id="choose">Choose your favorite wallet and get a proof of ownership !</p>
                </div>
              </div>
              <div id="leftMid">
                <div id="frame4">
                  {{navbar|safe}}
                </div>
                <div id="frame11">
                  <div id="frame1">
                    <button id="requestPermission5" class="transparent">
                      <div class="box1">
                        <div class="underbox1">
                          <div class="frame2">
                            <div><img id="beaconlogo" src="/static/kukai.png"></div>
                            <div>
                              <p class="walletText">Kukai Wallet</p>
                            </div>
                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    <button id="requestPermission1" class="transparent">
                      <div class="box1">
                        <div class="underbox1">
                          <div class="frame2">
                            <div><img id="beaconlogo" src="/static/trustwallet.png"></div>
                            <div>
                              <p class="walletText">Trust Wallet
                              </p>
                            </div>
                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    <button id="requestPermission6" class="transparent">
                      <div class="box2">
                        <div class="underbox2">
                          <div class="frame2">
                            <img id="templelogo" src="/static/temple-wallet.png">

                            <p class="walletText">Temple Mobile</p>

                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    <button id="requestPermission" class="transparent">
                      <div class="box1">
                        <div class="underbox1">
                          <div class="frame2">
                            <div><img id="beaconlogo" src="/static/umami.jpg"></div>
                            <div>
                              <p class="walletText">Umami</p>
                            </div>
                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    <button id="requestPermission2" class="transparent">
                      <div class="box2">
                        <div class="underbox2">
                          <div class="frame2">
                            <img id="templelogo" src="/static/temple-wallet.png">

                            <p class="walletText">Temple Web Extension</p>

                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    <button id="requestPermission4" class="transparent">
                      <div class="box2">
                        <div class="underbox2">
                          <div class="frame2">
                            <img id="templelogo" src="/static/airgap.png">

                            <p class="walletText">Air Gap Wallet</p>

                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    <button id="requestPermission3" class="transparent">
                      <div class="box1">
                        <div class="underbox1">
                          <div class="frame2">
                            <div><img id="beaconlogo" src="/static/digitalartautonomy.webp"></div>
                            <div>
                              <p class="walletText">Digital Art Autonomy
                              </p>
                            </div>
                          </div>
                          <div class="frame3"><img class="vector" src="/static/vector.png"></div>
                        </div>
                      </div>
                    </button>
                    
                    
                  </div>
                </div>
              </div>

              <div id="frame6">
                <p id="ssi">** Self-Sovereign Identity (SSI) gives individuals control over the personal information
                  they
                  use across the web.</p>
                  <button id="logout">Disconnect Wallet</button>



              </div>


            </div>

          </div>
        </div>
      </div>
    </div>
      
      {% include 'faq.html' %}





    </div>

  </div>

  <div id="footer" class="bg-white-color ">
    <footer class="footer-02" id="footer">

      <div class="footer-02__wrapper">
        <div class="footer-02__text content_box">
          <p id="line1Footer">&copy; 2022&nbsp; TALAO - Altme All rights reserved, <a href="https://altme.io/cgu/"
              target="_blank">CGU</a>, <a href="https://altme.io/privacy/" target="_blank">Privacy</a></p>
          <p id="line2Footer" hidden><strong>Built with TzKT API, Spruce Didkit 0.4.0</strong>&nbsp;</p>
        </div>
        <div class="social-buttons  ">

          <div class="social-buttons__item twitter"><a class="social-buttons__link social-buttons__link--twitter"
              href="https://twitter.com/Altme_io" target="_blank"><img loading="lazy" class="social-buttons__icon"
                alt="twitter icon"
                src="https://dvzvtsvyecfyp.cloudfront.net/static/img/icons/social/black/twitter.svg" /></a></div>
          <div class="social-buttons__item linkedin"><a class="social-buttons__link social-buttons__link--linkedin"
              href="https://www.linkedin.com/company/altme-web3/" target="_blank"><img loading="lazy"
                class="social-buttons__icon" alt="linkedin icon"
                src="https://dvzvtsvyecfyp.cloudfront.net/static/img/icons/social/black/linkedin.svg" /></a></div>

        </div>
      </div>

    </footer>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/@taquito/utils"></script>
  <script>
    var wallet = ""


    //document.getElementById('altme').style.visibility = 'hidden';


    // Initiate DAppClient
    const client = beacon.getDAppClientInstance({
      name: 'Altme', // Name of the DApp,
      disclaimerText: '',
      errorMessages: {

      }

    })

    // Display the active account in the UI
    const updateActiveAccount = () => {
      client.getActiveAccount().then((activeAccount) => {
        if (activeAccount) {
          console.log(activeAccount)
          console.log(activeAccount.publicKey)
          console.log("activeaccount")


        } else {

        }
      })
    }
    updateActiveAccount()


    signPayloadOwning = async () => {
      const signature = await client.requestSignPayload({
        signingType: beacon.SigningType.MICHELINE,
        payload: '{{nonce}}'
      })
      console.log('signature:', signature)
      let link = "{{link}}";


      client.getActiveAccount().then((activeAccount) => {
        if (activeAccount) {
          document.getElementById('logout').setAttribute('class', '')

          fetch(link, { method: "GET", headers: { pubKey: activeAccount.publicKey, signature: signature.signature, address: activeAccount.address } }).then((res) => {
            res.json().then((data) => {
              /*console.log("data");
              console.log(data);
              console.log("data");*/
              if (data.status === "ok") {
                fetch("/", { method: "POST", headers: { wallet: wallet, cryptoWalletSignature: signature.signature } }).then((res) => {
                  //document.location.href = res.url
                  console.log("res")
                  res.json().then(
                    (urlJson) => {
                      fetch(urlJson.url).then((qrcode) => {
                        qrcode.json().then((qrcodeLink) => {
                          console.log(qrcodeLink.url)
                          let element = document.getElementById('frame11');
                          element.remove();
                          let element2 = document.getElementById('frame4');
                          element2.remove();
                          var qr = document.createElement("div");
                          qr.setAttribute('id', 'qrcode')
                          document.getElementById("leftMid").appendChild(qr);
                          let aLink = document.createElement('a')
                          aLink.setAttribute('href', "https://app.altme.io/app/download?uri="+qrcodeLink.url)
                          document.getElementById("qrcode").appendChild(aLink)
                          let buttonLink = document.createElement('input')
                          buttonLink.setAttribute('type','button')
                          buttonLink.setAttribute("value","Open your wallet")
                          buttonLink.setAttribute('id','buttonDeepLink')
                          aLink.appendChild(buttonLink)

                          //new QRCode(document.getElementById("qrcode"), qrcodeLink.url);
                          document.getElementById('step1').innerHTML = "Step 2 : Scan this QR code with Altme"
                          document.getElementById('choose').innerHTML = ""

                          var source = new EventSource('/stream');
                          source.onmessage = function (event) {
                            const data = JSON.parse(event.data)
                            // voir ce que l on fait apres
                            if (data.id == qrcodeLink.id) {
                              document.getElementById('qrcode').remove()
                              let greenlogo = document.createElement("img")
                              document.getElementById("leftMid").appendChild(greenlogo);
                              greenlogo.setAttribute('id', 'qrcodelogo')
                              document.getElementById('qrcodelogo').setAttribute('src', '/static/tick-circle.png')
                              let success = document.createElement("p")
                              document.getElementById("leftMid").appendChild(success);
                              success.setAttribute('id', 'success')
                              success.innerHTML = "Success !"
                            }
                          };
                        }
                        )
                      })
                    }
                  )

                })
              }
            });
          });
          console.log(activeAccount.publicKey)
        }
      })

    }
    document.getElementById('logout').addEventListener('click', () => {
      client.disconnect();
      document.getElementById('logout').setAttribute('class', 'hidden')
    })

    // Initiate a permission request
    const requestPermission = (callback) => {
      client
        .requestPermissions(/*{ network: { type: beacon.NetworkType.DELPHINET } }*/)
        .then((permissions) => {
          console.log('permissions', permissions)
          wallet = ""
          try {
            wallet = permissions.appMetadata.name
          } catch (e) { }
          if (callback) {
            callback(permissions)
          }
          updateActiveAccount()
          signPayloadOwning()
        })
        .catch((error) => {
          console.log('error during permission request', error)
        })
    }



    // Add event listener to the button
    document.getElementById('requestPermission').addEventListener('click', () => {
      requestPermission()
    })
    document.getElementById('requestPermission1').addEventListener('click', () => {
      requestPermission()
    })
    document.getElementById('requestPermission2').addEventListener('click', () => {
      requestPermission()
    })
    document.getElementById('requestPermission3').addEventListener('click', () => {
      requestPermission()
    })
    document.getElementById('requestPermission4').addEventListener('click', () => {
      requestPermission()
    })
    document.getElementById('requestPermission5').addEventListener('click', () => {
      requestPermission()
    })
    document.getElementById('requestPermission6').addEventListener('click', () => {
      requestPermission()
    })

  </script>



</body>

</html>